name: Test Scheduled workflow
on:
  workflow_dispatch:
#  schedule:
#    - cron: '15 * * * *'
#    - cron: '0,30,45 * * * *'

jobs:
  test-schedule:
    if: github.ref == 'refs/heads/main' && (github.event_name == 'workflow_dispatch' || github.event.schedule == '15 * * * *')
    runs-on: ubuntu-latest
    steps:
    - name: Event name
      run: |
        echo " ${{ github.event_name }} "

    - name: Dump GitHub context
      id: github_context_step
      run: echo '${{ toJSON(github) }}'

    - name: Dump job context
      run: echo '${{ toJSON(job) }}'

    - name: Dump steps context
      run: echo '${{ toJSON(steps) }}'

    - name: Dump runner context
      run: echo '${{ toJSON(runner) }}'

    - name: Dump strategy context
      run: echo '${{ toJSON(strategy) }}'

    - name: Dump matrix context
      run: echo '${{ toJSON(matrix) }}'

    - name: Echo schedule
      run: echo '${{ github.event.schedule }}'

    - name: Determine if we're going to run in-place TP updates
      id: tp-in-place-update-flag
      run: |
        if [[ '${{ github.event.schedule }}' == '15 * * * *' ]]; then
          echo "inPlaceUpdate=false" >> $GITHUB_OUTPUT
        else
          echo "inPlaceUpdate=true" >> $GITHUB_OUTPUT
        fi

    - name: Echo in-place-updated flag
      run: echo "${{ steps.tp-in-place-update-flag.outputs.inPlaceUpdate }}"
